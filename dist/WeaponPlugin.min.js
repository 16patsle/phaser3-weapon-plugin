!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("WeaponPlugin",[],e):"object"==typeof exports?exports.WeaponPlugin=e():t.WeaponPlugin=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var r=i[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={KILL_NEVER:0,KILL_LIFESPAN:1,KILL_DISTANCE:2,KILL_WEAPON_BOUNDS:3,KILL_CAMERA_BOUNDS:4,KILL_WORLD_BOUNDS:5,KILL_STATIC_BOUNDS:6,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,BULLET_FRAME_STABLE:0,BULLET_FRAME_CYCLE:1,BULLET_FRAME_RANDOM:2};e.default=s},function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function l(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?c(t):e}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var f=function(t){return t&&t.__esModule?t:{default:t}}(i(0)),d=0,y=function(t){function e(t,i,s,n,l){var u;return r(this,e),u=a(this,o(e).call(this,t,i,s,n,l)),u.bulletID=d,d++,u.scene.physics.add.existing(c(c(u))),u.data={timeEvent:null,bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0,bodyBounds:new Phaser.Geom.Rectangle},u}return u(e,t),l(e,[{key:"prepare",value:function(t,e){this.setActive(!0),this.setVisible(!0),this.body.enable=!0,this.body.reset(t,e),this.body.debugShowBody=this.data.bulletManager.debugPhysics,this.body.debugShowVelocity=this.data.bulletManager.debugPhysics}},{key:"kill",value:function(){return this.body.stop(),this.body.enable=!1,this.setActive(!1),this.setVisible(!1),this.body.debugShowBody=!1,this.body.debugShowVelocity=!1,null!==this.data.timeEvent&&(this.data.timeEvent.destroy(),this.data.timeEvent=null),this.data.bulletManager.eventEmitter.emit("kill",this),this}},{key:"update",value:function(){this.active&&(this.data.killType>f.default.KILL_LIFESPAN&&(this.data.killType===f.default.KILL_DISTANCE?new Phaser.Math.Vector2(this.data.fromX,this.data.fromY).distance(this)>this.data.killDistance&&this.kill():Phaser.Geom.Intersects.RectangleToRectangle(this.data.bulletManager.bulletBounds,this.body.getBounds(this.data.bodyBounds))||this.kill()),this.data.rotateToVelocity&&(this.rotation=this.body.velocity.atan()),this.data.bulletManager.bulletWorldWrap&&this.scene.physics.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))}}]),e}(Phaser.GameObjects.Sprite),b=y;e.default=b},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),t}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d=s(i(3)),y=s(i(1)),b=s(i(0)),p=function(t){function e(t,i){var s;return n(this,e),s=o(this,h(e).call(this,t,i)),s.weapons=[],s}return c(e,t),a(e,[{key:"add",value:function(t,e,i,s,r){r||(r=d.default);var n=new r(this.scene,t,e,i,s);return this.weapons.push(n),n}},{key:"start",value:function(){this.systems.events.on("postrender",this.postRender,this)}},{key:"boot",value:function(){var t=this.systems.events;t.on("preupdate",this.preUpdate,this),t.on("update",this.update,this),t.on("postupdate",this.postUpdate,this),t.on("pause",this.pause,this),t.on("resume",this.resume,this),t.on("sleep",this.sleep,this),t.on("wake",this.wake,this),t.on("shutdown",this.shutdown,this),t.on("destroy",this.destroy,this)}},{key:"preUpdate",value:function(t,e){}},{key:"update",value:function(t,e){this.weapons.forEach(function(t){t.update()})}},{key:"postUpdate",value:function(t,e){}},{key:"postRender",value:function(){this.weapons.forEach(function(t){t.postRender()})}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"sleep",value:function(){}},{key:"wake",value:function(){}},{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.pluginManager=null,this.game=null,this.scene=null,this.systems=null}}]),e}(Phaser.Plugins.ScenePlugin);p.Weapon=d.default,p.Bullet=y.default,p.consts=b.default;var m=p;e.default=m},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function l(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=s(i(1)),o=s(i(0)),u=function(){function t(e,i,s,n,l){r(this,t),this.scene=e,this.debugPhysics=null,this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new Phaser.Geom.Rectangle(0,0,1,1),this.fireAngle=o.default.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new Phaser.Math.Vector2(0,0),this.bulletRotateToVelocity=!1,this.bulletKey=s||"",this.bulletFrame=n||"",this._bulletClass=a.default,this._bulletCollideWorldBounds=!1,this._bulletKillType=o.default.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new Phaser.Geom.Rectangle,this.bulletBounds=this.scene.physics.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.trackedSprite=null,this.trackedPointer=null,this.multiFire=!1,this._hasFired=!1,this.trackRotation=!1,this.trackOffset=new Phaser.Math.Vector2,this._nextFire=0,this._tempNextFire=0,this._rotatedPoint=new Phaser.Math.Vector2,this.eventEmitter=new Phaser.Events.EventEmitter,this.createBullets(i,s,n,l)}return l(t,[{key:"createBullets",value:function(t,e,i,s,r){return void 0===t&&(t=1),r&&(this._bulletClass=r),this.bullets&&!this.bullets.scene&&(this.bullets=null),this.bullets||(this.bullets=this.scene.add.group({classType:this._bulletClass,maxSize:t,runChildUpdate:!0})),0!==t&&(-1===t&&(this.autoExpandBulletsGroup=!0,t=1),this.bullets.createMultiple({key:e,frame:i,repeat:t,active:!1,visible:!1}),this.bullets.children.each(function(t){t.data.bulletManager=this},this),this.bulletKey=e,this.bulletFrame=i,s&&s.addMultiple(this.bullets.children.entries)),this}},{key:"forEach",value:function(t,e){var i=arguments;return this.bullets.children.each(function(s){s.active&&t.call(e,s,i)}),this}},{key:"pauseAll",value:function(){return this.bullets.children.each(function(t){t.body.enable=!1,null!==t.data.timeEvent&&(t.data.timeEvent.paused=!0)},this),this}},{key:"resumeAll",value:function(){return this.bullets.children.each(function(t){t.body.enable=!0,null!==t.data.timeEvent&&(t.data.timeEvent.paused=!1)},this),this}},{key:"killAll",value:function(){return this.bullets.children.each(function(t){t.active&&t.kill(),t.body.enable=!0}),this}},{key:"resetShots",value:function(t){return this.shots=0,void 0!==t&&(this.fireLimit=t),this}},{key:"trackSprite",value:function(t,e,i,s){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=!1),this.trackedPointer=null,this.trackedSprite=t,this.trackRotation=s,this.trackOffset.set(e,i),this}},{key:"trackPointer",value:function(t,e,i){return void 0===t&&this.scene.input&&(t=this.scene.input.activePointer),void 0===e&&(e=0),void 0===i&&(i=0),this.trackedPointer=t,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(e,i),this}},{key:"fireMany",value:function(t,e){var i=this;this.multiFire=!0;var s=[];return e||this.trackedSprite||this.trackedPointer?t.forEach(function(t){s.push(i.fire(e,null,null,t.x,t.y))}):t.forEach(function(t){s.push(i.fire(t))}),s}},{key:"fireOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.fire(null,null,null,t,e)}},{key:"fireAtPointer",value:function(t){return void 0===t&&this.scene.input&&(t=this.scene.input.activePointer),this.fire(null,t.x,t.y)}},{key:"fireAtSprite",value:function(t){return this.fire(null,t.x,t.y)}},{key:"fireAtXY",value:function(t,e){return this.fire(null,t,e)}},{key:"fire",value:function(t,e,i,s,r){if(void 0===e&&(e=null),void 0===i&&(i=null),this.scene.time.now<this._nextFire||this.fireLimit>0&&this.shots===this.fireLimit)return null;var n=this.bulletSpeed;0!==this.bulletSpeedVariance&&(n+=Phaser.Math.Between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),t?this.fireFrom.width>1?this.fireFrom.CenterOn(t.x,t.y):(this.fireFrom.x=t.x,this.fireFrom.y=t.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.x+this.trackOffset.x,this.trackedSprite.y+this.trackOffset.y),Phaser.Math.RotateAround(this._rotatedPoint,this.trackedSprite.x,this.trackedSprite.y,this.trackedSprite.rotation),this.fireFrom.width>1?this.fireFrom.CenterOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):this.fireFrom.width>1?this.fireFrom.CenterOn(this.trackedSprite.x+this.trackOffset.x,this.trackedSprite.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(n+=this.trackedSprite.body.speed)):this.trackedPointer&&(this.fireFrom.width>1?this.fireFrom.CenterOn(this.trackedPointer.x+this.trackOffset.x,this.trackedPointer.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.y+this.trackOffset.y)),void 0!==s&&(this.fireFrom.x+=s),void 0!==r&&(this.fireFrom.y+=r);var l=this.fireFrom.x+Math.random()*this.fireFrom.width,a=this.fireFrom.y+Math.random()*this.fireFrom.height,u=this.fireFrom.width>1?l:this.fireFrom.x,h=this.fireFrom.height>1?a:this.fireFrom.y,c=this.trackRotation?this.trackedSprite.angle:this.fireAngle;null!==e&&null!==i&&(c=Phaser.Math.RadToDeg(Math.atan2(i-h,e-u))),0!==this.bulletAngleVariance&&(c+=Phaser.Math.Between(-this.bulletAngleVariance,this.bulletAngleVariance));var f=0,d=0;0===c||180===c?f=Math.cos(Phaser.Math.DegToRad(c))*n:90===c||270===c?d=Math.sin(Phaser.Math.DegToRad(c))*n:(f=Math.cos(Phaser.Math.DegToRad(c))*n,d=Math.sin(Phaser.Math.DegToRad(c))*n);var y=null;if(this.autoExpandBulletsGroup?(y=this.bullets.getFirstDead(!0,u,h,this.bulletKey,this.bulletFrame),y.data.bulletManager=this):y=this.bullets.getFirstDead(!1),y){if(y.prepare(u,h),y.data.fromX=u,y.data.fromY=h,y.data.killType=this.bulletKillType,y.data.killDistance=this.bulletKillDistance,y.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===o.default.KILL_LIFESPAN){if(this.bulletLifespan<=0)throw new Error("Invalid bulletLifespan; must be > 0");y.data.timeEvent=this.scene.time.addEvent({delay:this.bulletLifespan,callback:y.kill.bind(y)}),y.lifespan=this.bulletLifespan}if(y.angle=c+this.bulletAngleOffset,this.bulletAnimation)y.anims.play(this.bulletAnimation);else if(this.bulletFrameCycle)this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0),y.setTexture(this.bulletKey,this.bulletFrameIndex),this.bulletFrameIndex++;else if(this.bulletFrameRandom){var b=Math.floor(Math.random()*this.bulletFrames.length);y.setTexture(this.bulletKey,b)}y.data.bodyDirty&&(this._data.customBody&&(y.body.setSize(this._data.width,this._data.height),y.body.setOffset(this._data.offsetX,this._data.offsetY)),y.body.collideWorldBounds=this.bulletCollideWorldBounds,y.data.bodyDirty=!1),y.body.setVelocity(f,d),y.body.setGravity(this.bulletGravity.x,this.bulletGravity.y);var p=0;if(0!==this.bulletSpeedVariance){var m=this.fireRate;m+=Phaser.Math.Between(-this.fireRateVariance,this.fireRateVariance),m<0&&(m=0),p=this.scene.time.now+m}else p=this.scene.time.now+this.fireRate;this.multiFire?this._hasFired||(this._hasFired=!0,this._tempNextFire=p,this.shots++):(this._nextFire=p,this.shots++),this.eventEmitter.emit("fire",y,this,n),this.fireLimit>0&&this.shots===this.fireLimit&&this.eventEmitter("firelimit",this,this.fireLimit)}return y}},{key:"setBulletBodyOffset",value:function(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this._data.customBody=!0,this._data.width=t,this._data.height=e,this._data.offsetX=i,this._data.offsetY=s,this.bullets.children.each(function(r){r.body.setSize(t,e),r.body.setOffset(i,s)}),this}},{key:"setBulletFrames",value:function(t,e,i){if(void 0===i&&(i=o.default.BULLET_FRAME_STABLE),"number"!=typeof i||i<o.default.BULLET_FRAME_STABLE||i>o.default.BULLET_FRAME_RANDOM)throw new Error("Invalid bullet frame selection method specified: ".concat(i));if(t>e)throw new Error("min frame (".concat(t,") must be <= max frame ").concat(e));return this.bulletFrames=Phaser.Utils.Array.NumberArray(t,e),this.bulletFrameIndex=0,this.bulletFrameCycle=i===o.default.BULLET_FRAME_CYCLE,this.bulletFrameRandom=i===o.default.BULLET_FRAME_RANDOM,this}},{key:"addBulletAnimation",value:function(t,e,i,s){return this.scene.sys.anims.anims.contains(t)||(this.scene.sys.anims.create({key:t,frames:e,frameRate:i,loop:s}),this.anims[t]=this.scene.sys.anims.anims.entries[t]),this.bulletAnimation=t,this}},{key:"debug",value:function(t,e,i){}},{key:"update",value:function(){this._bulletKillType===o.default.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.x,this.trackedSprite.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.x,this.trackedPointer.y)),this.autofire&&this.fire()}},{key:"postRender",value:function(){this.multiFire&&this._hasFired&&(this._hasFired=!1,this._nextFire=this._tempNextFire)}},{key:"destroy",value:function(){this.scene=null,this.bullets.destroy(!0)}}]),t}();Object.defineProperty(u.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t,this.bullets&&(this.bullets.classType=this._bulletClass)}}),Object.defineProperty(u.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case o.default.KILL_STATIC_BOUNDS:case o.default.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case o.default.KILL_CAMERA_BOUNDS:this.bulletBounds=this.scene.sys.cameras.main._bounds;break;case o.default.KILL_WORLD_BOUNDS:this.bulletBounds=this.scene.physics.world.bounds}this._bulletKillType=t}}),Object.defineProperty(u.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t,this.bullets.children.each(function(e){e.body.collideWorldBounds=t,e.data.bodyDirty=!1})}}),Object.defineProperty(u.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}}),Object.defineProperty(u.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}});var h=u;e.default=h}]).default});
//# sourceMappingURL=WeaponPlugin.min.js.map